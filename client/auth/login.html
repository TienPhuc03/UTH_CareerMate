<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <title>Login Form</title>
</head>

<body>
    <div class="flex items-center justify-center min-h-screen bg-gray-100">
        <div class="relative flex flex-col m-6 space-y-8 bg-white shadow-2xl rounded-2xl md:flex-row md:space-y-0">
            <div class="flex flex-col justify-center p-8 md:p-14">
                <span class="mb-3 text-4xl font-bold text-green-600">Đăng nhập</span>
                <span class="font-light text-gray-400 mb-8">Xây dựng, cập nhật và quản lý CV chuyên nghiệp</span>

                <!-- Alert Message -->
                <div id="alertMessage" class="hidden mb-4 p-3 rounded-lg text-sm"></div>

                <form id="loginForm">
                    <div class="py-4">
                        <span class="text-green-600 font-bold mb-2 text-md">Email</span>
                        <input type="email"
                            class="w-full p-2 border border-gray-300 rounded-md placeholder:font-light placeholder:text-gray-500"
                            name="email" id="email" placeholder="Địa chỉ Email" required>
                    </div>
                    <!-- Password -->
                    <div class="py-2">
                        <span class="mb-2 text-md font-bold text-green-600">Mật khẩu</span>
                        <div class="relative">
                            <input type="password" id="password" placeholder="Mật khẩu"
                                class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 pr-10"
                                required>
                            <button type="button" onclick="togglePassword('password', 'eye-icon-pass')"
                                class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-500 hover:text-green-600 focus:outline-none">
                                <i id="eye-icon-pass" class="fa-solid fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="flex justify-between w-full py-4">
                        <div class="mr-24">
                            <input type="checkbox" name="ch" id="ch" class="mr-2">
                            <span class="text-md font-light">Nhớ mật khẩu</span>
                        </div>
                        <span class="font-bold text-green-600 text-md cursor-pointer hover:text-gray-600">Quên mật
                            khẩu</span>
                    </div>
                    <button type="submit" id="submitBtn"
                        class="w-full font-bold text-white p-2 bg-green-600 rounded-lg mb-6 hover:bg-white hover:text-black hover:border hover:border-gray-300 transition">
                        Đăng nhập
                    </button>
                </form>

                <button
                    class="w-full border border-gray-300 text-md p-2 rounded-lg mb-6 hover:bg-black hover:text-white transition">
                    <img src="https://img.icons8.com/color/50/google-logo.png" alt="img" class="w-6 h-6 inline mr-2">
                    Đăng nhập với Google
                </button>
                <div class="text-center text-gray-400">
                    Bạn chưa có tài khoản? <a href="signup.html" class="font-bold text-black hover:underline">Đăng ký
                    </a>
                </div>
            </div>
            <div class="relative">
                <img src="../src/img/Login.jpg" alt="img"
                    class="w-[400px] h-full hidden rounded-r-2xl md:block object-cover">
                <!-- Text on Image -->
                <div
                    class="absolute hidden bottom-10 right-6 left-6 p-6 bg-white bg-opacity-30 backdrop-blur-sm rounded drop-shadow-lg md:block">
                    <span class="text-white text-xl">
                        Nâng cao sự nghiệp của bạn bằng cách xây dựng và quản lý CV chuyên nghiệp để nắm bắt các cơ hội
                        việc làm thực tế.</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://127.0.0.1:8000/api/Auth';

        document.getElementById("loginForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            const submitBtn = document.getElementById("submitBtn");
            const alertMessage = document.getElementById("alertMessage");

            // Disable button and show loading
            submitBtn.disabled = true;
            submitBtn.textContent = 'Signing in...';
            alertMessage.classList.add('hidden');

            try {
                const res = await fetch(`${API_URL}/login`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });

                const data = await res.json();

                if (res.ok) {
                    // Save token to localStorage
                    localStorage.setItem('access_token', data.access_token);
                    localStorage.setItem('user_email', email);

                    // Show success message
                    showAlert('Đăng nhập thành công!', 'success');

                    // Redirect to homepage 
                    setTimeout(() => {
                        window.location.href = "../component/Homepage.html";
                    }, 1000);
                } else {
                    // Show error message
                    showAlert(data.detail || 'Email hoặc mật khẩu không hợp lệ', 'error');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Sign In';
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('Không thể kết nối đến máy chủ, vui lòng kiểm tra!', 'error');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Sign In';
            }
        });

        function showAlert(message, type) {
            const alertMessage = document.getElementById('alertMessage');
            alertMessage.className = `mb-4 p-3 rounded-lg text-sm ${type === 'success'
                ? 'bg-green-100 text-green-700 border border-green-400'
                : 'bg-red-100 text-red-700 border border-red-400'
                }`;
            alertMessage.textContent = message;
            alertMessage.classList.remove('hidden');
        }

        // --- TÍNH NĂNG: HIỆN/ẨN MẬT KHẨU ---
        function togglePassword(inputId, iconId) {
            const input = document.getElementById(inputId);
            const icon = document.getElementById(iconId);

            if (input.type === "password") {
                input.type = "text"; // Hiện mật khẩu
                icon.classList.remove("fa-eye");
                icon.classList.add("fa-eye-slash"); // Đổi icon thành mắt gạch chéo
            } else {
                input.type = "password"; // Ẩn mật khẩu
                icon.classList.remove("fa-eye-slash");
                icon.classList.add("fa-eye"); // Đổi icon về mắt thường
            }
        }
    </script>
</body>

</html>